Alpine.data("app",(function(){return{inputsFilter:{dt_inicial:null,dt_final:null,cd_cartao:null,cd_forma:null,aberto:!1,fechado:!1,quitado:!1,ano:(new Date).getFullYear(),mes:(new Date).getMonth()+1},cartaoFiltroSelecionado:null,cartoes:[],cartaoSelecionado:null,loadingModalCartao:!1,inputsModalCartao:{cd_empresa:null,cd_conta_pag:null,cd_forma:null,descricao:null,documento:null,dt_pagamento:null,vl_pago:null},classStyleStatusCartao:{ABERTA:"label-primary",QUITADA:"label-success",FECHADA:"label-danger",VENCIDA:"label-danger"},templateButtonSalvar:'<i class="fa fa-check"></i> Salvar',templateButtonSalvando:" <i class='fa fa-spinner fa-spin' aria-hidden='true'></i> Salvando ",buttonSalvar:'<i class="fa fa-check"></i> Salvar',saldoCartao:null,init:function(){var a=this;$("#filtersCartao").on("select2:select",(function(t){a.inputsFilter.cd_cartao=t.params.data.id,a.cartaoFiltroSelecionado=cartoesParaSelecao.find((function(a){return a.cd_conta==t.params.data.id})),t.params.data.id&&(a.saldoCartao=" <i class='fa fa-spinner fa-spin' aria-hidden='true'></i> ",axios.get("/rpclinica/json/financeiro-info-cartao/"+t.params.data.id).then((function(t){a.saldoCartao=a.formatValor(t.data.saldo)})).catch((function(t){toastr.error(t.response.data.message,"Erro"),a.saldoCartao=null})))})),$("#filtersForma").on("select2:select",(function(t){return a.inputsFilter.cd_forma=t.params.data.id})),$("#empresaModalCartao").on("select2:select",(function(t){return a.inputsModalCartao.cd_empresa=t.params.data.id})),$("#contaModalCartao").on("select2:select",(function(t){return a.inputsModalCartao.cd_conta_pag=t.params.data.id})),$("#formaModalCartao").on("select2:select",(function(t){return a.inputsModalCartao.cd_forma=t.params.data.id})),$("#modal-detalhes").on("hidden.bs.modal",(function(){return a.clearInputsModalCartao()})),this.submitFilters()},prevYear:function(){this.inputsFilter.ano=this.inputsFilter.ano-1,this.submitFilters()},nextYear:function(){this.inputsFilter.ano=this.inputsFilter.ano+1,this.submitFilters()},selectMonth:function(a){this.inputsFilter.mes=a,this.submitFilters()},prevMonth:function(){this.inputsFilter.mes=this.inputsFilter.mes>1?this.inputsFilter.mes-1:this.inputsFilter.mes,this.submitFilters()},nextMonth:function(){this.inputsFilter.mes=this.inputsFilter.mes<12?this.inputsFilter.mes+1:this.inputsFilter.mes,this.submitFilters()},submitFilters:function(){var a=this;$("#checkboxAberto").is(":checked")?this.inputsFilter.aberto=!0:this.inputsFilter.aberto=!1,$("#checkboxFechado").is(":checked")?this.inputsFilter.fechado=!0:this.inputsFilter.fechado=!1,$("#checkboxQuitado").is(":checked")?this.inputsFilter.quitado=!0:this.inputsFilter.quitado=!1,axios.get("/rpclinica/json/financeiro-relacao-cartao",{params:this.inputsFilter}).then((function(t){a.cartoes=t.data.query,console.log(t.data)})).catch((function(a){return parseErrorsAPI(a)}))},sumValueItemsCartoes:function(a){return a?a.reduce((function(a,t){return t.vl_boleto+a}),0):0},selectCartao:function(a){this.cartaoSelecionado=a,console.log(a),$("#empresaModalCartao").val(this.cartaoSelecionado.cd_empresa).trigger("change"),$("#contaModalCartao").val(this.cartaoSelecionado.cd_conta_pag).trigger("change"),$("#formaModalCartao").val(this.cartaoSelecionado.cd_forma).trigger("change"),$("#modal-detalhes").modal("show")},formatValor:function(a){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a)},fecharFatura:function(){var a=this;this.loadingModalCartao=!0,axios.post("/rpclinica/json/financeiro-fechar-cartao",this.cartaoSelecionado).then((function(t){a.submitFilters(),toastr.success("Fatura fechada!"),$("#modal-detalhes").modal("toggle")})).catch((function(a){return parseErrorsAPI(a)})).finally((function(){return a.loadingModalCartao=!1}))},atualizarFatura:function(){var a=this;this.buttonSalvar=this.templateButtonSalvando;var t=new FormData(document.querySelector("#atualizarFatura"));t.set("cd_fatura",this.cartaoSelecionado.cd_fatura),axios.post("/rpclinica/json/financeiro-atualizar-cartao",t).then((function(t){a.submitFilters(),toastr.success("Fatura atualizada!"),$("#modal-detalhes").modal("toggle")})).catch((function(a){toastr.error(a.response.data.message,"Erro")})).finally((function(){a.buttonSalvar=a.templateButtonSalvar,a.loadingModalCartao=!1}))},abrirFatura:function(a){var t=this;this.loadingModalCartao=!0,axios.post("/rpclinica/json/financeiro-abrir-cartao",{cd_fatura:a}).then((function(a){t.cartaoSelecionado.fatura=a.data,t.submitFilters(),toastr.success("Fatura aberta!"),$("#modal-detalhes").modal("toggle")})).catch((function(a){return parseErrorsAPI(a)})).finally((function(){return t.loadingModalCartao=!1}))},estornarFatura:function(a){var t=this;this.loadingModalCartao=!0,axios.post("/rpclinica/json/financeiro-estornar-cartao",{cd_fatura:a}).then((function(a){t.submitFilters(),toastr.success("Fatura Estornada!"),$("#modal-detalhes").modal("toggle")})).catch((function(a){toastr.error(a.response.data.message,"Erro")})).finally((function(){return t.loadingModalCartao=!1}))},clearInputsModalCartao:function(){this.inputsModalCartao={cd_empresa:null,cd_conta_pag:null,cd_forma:null,descricao:null,documento:null,dt_pagamento:null,vl_pago:null},$("#empresaModalCartao").val(null).trigger("change"),$("#contaModalCartao").val(null).trigger("change"),$("#formaModalCartao").val(null).trigger("change")}}})),$(document).ready((function(){$("#modal-detalhes").modal({backdrop:"static",show:!1})}));