Alpine.data("app",(function(){return{buttonDisabled:!1,loading:!1,loadingTela:"doc",snEdicaoDoc:!1,loadingDoc:!1,pacientes:[],pacienteSelected:null,valuesEstadoCivil:{S:"Solteiro",C:"Casado",D:"Divorciado",V:"Viúvo"},msg:{titulo:"",file:"",msg:"",doc:"",celular:"",compartilhar:"ZAP"},classLabelSituacao:{livre:"label-success",agendado:"label-primary",confirmado:"label-info",atendido:"label-warning",bloqueado:"label-danger"},loadingConsulta:!1,historicoAgendamentoSelected:null,historicoPrintAgendamento:!1,Anamnese:{Documento:"",Titulo:"",cdDocumento:null},dadosDocumentos:[],dadosEnvios:[],buttonSalvar:" <i class='fa fa-check'></i>  Salvar ",buttonEnviar:"<i class='fa fa-send-o'></i> Enviar ",editorFormulario:null,init:function(){var o=this;this.pacientes=pacientes,this.editorFormulario=CKEDITOR.replace("editor-formulario",{toolbarGroups:[{name:"basicstyles",groups:["basicstyles"]},{name:"undo",groups:["Undo","Redo"]},{name:"paragraph",groups:["list","blocks"]},{name:"insert",groups:["insert"]},{name:"styles",groups:["styles"]}],removeButtons:"Subscript,Superscript,",resize_enabled:!1,removePlugins:"elementspath",height:["300px"],enterMode:CKEDITOR.ENTER_BR,shiftEnterMode:CKEDITOR.ENTER_BR}),$("#modeloDocumento").on("select2:select",(function(e){var t=e.params.data.id;axios.get("/rpclinica/json/paciente-doc/".concat(t,"/").concat(o.pacienteSelected.cd_paciente)).then((function(e){o.editorFormulario.setData(e.data.retorno),o.Anamnese.Documento=e.data.retorno,o.Anamnese.Titulo=e.data.nm_formulario})).catch((function(o){toastr.error(o.response.data.message,"Erro")}))})),$("#modal-resumo-paciente").on("hidden.bs.modal",(function(){$("#procedimento").val(null).trigger("change"),$("#convenio").val(null).trigger("change"),$("#especialidade").val(null).trigger("change")}))},openModal:function(o){this.pacienteSelected=this.pacientes.find((function(e){return e.cd_paciente==o})),$("#convenio").val(this.pacienteSelected.cd_categoria).trigger("change"),$("#cartao").val(this.pacienteSelected.cartao),$("#modal-resumo-paciente").modal("show")},submitConsulta:function(){var o=this;this.loadingConsulta=!0;var e=new FormData(this.$refs.formIniciarConsulta);axios.post("/rpclinica/json/paciente-iniciar-consulta",e).then((function(o){return location.href=o.data.consulta})).catch((function(o){return toastr.error(o.response.data.message)})).finally((function(){return o.loadingConsulta=!1}))},openModalHistorico:function(o){this.pacienteSelected=this.pacientes.find((function(e){return e.cd_paciente==o})),$("#modal-historico-paciente").modal("show")},openModalHistoricoAgendamento:function(o){this.historicoAgendamentoSelected=this.pacienteSelected.agendamentos.find((function(e){return e.cd_agendamento==o})),this.historicoPrintAgendamento=!0},imprimirAnamnese:function(){var o="/rpclinica/consulta/anamnese/download-pdf/".concat(this.historicoAgendamentoSelected.cd_agendamento);axios.all([axios.get(o,{params:{tipo:"anamnese"},responseType:"blob"}),axios.get(o,{params:{tipo:"exame"},responseType:"blob"}),axios.get(o,{params:{tipo:"hipotese"},responseType:"blob"}),axios.get(o,{params:{tipo:"conduta"},responseType:"blob"})]).then(axios.spread((function(o,e,t,n){window.open(URL.createObjectURL(o.data),"anamnese.pdf"),window.open(URL.createObjectURL(e.data),"exame_fisico.pdf"),window.open(URL.createObjectURL(t.data),"hipotese_diagnostica.pdf"),window.open(URL.createObjectURL(n.data),"conduta.pdf")}))).catch((function(o){return toastr.error("Houve um erro ao imprimir.")}))},imprimirDocumento:function(o){axios.get("/rpclinica/consulta/anamnese/download-pdf/".concat(this.historicoAgendamentoSelected.cd_agendamento),{params:{tipo:"documento",cdDocumento:o},responseType:"blob"}).then((function(o){window.open(URL.createObjectURL(o.data),"documento.pdf")})).catch((function(o){return toastr.error("Houve um erro ao imprimir o documento!")}))},openModalDocumento:function(o){var e=this;this.loadingTela="doc",this.pacienteSelected=o,this.Anamnese.Documento=null,this.Anamnese.Titulo=null,this.snEdicaoDoc=!1,$("#modeloDocumento").val(null).trigger("change"),console.log(o),axios.get("/rpclinica/json/getDocumentoPacinete/".concat(o.cd_paciente)).then((function(o){e.editorFormulario.setData(""),e.dadosDocumentos=o.data.documento,e.dadosEnvios=o.data.envio})).catch((function(o){return toastr.error("Houve um erro ao carregar o documento!")}))},storeDocumento:function(){var o,e,t=this;this.loadingDoc=!0,this.loading=!0,this.buttonSalvar=" <i class='fa fa-spinner fa-spin' aria-hidden='true'></i> Salvando... ",this.buttonDisabled=!0;var n=new FormData(document.querySelector("#form_DOCUMENTO")),a=null!==(o=this.editorFormulario)&&void 0!==o&&o.getData()?null===(e=this.editorFormulario)||void 0===e?void 0:e.getData():"";n.set("documento",a),this.Anamnese.Documento=a,axios.post("/rpclinica/json/storeDocumentoPacinete/".concat(this.pacienteSelected.cd_paciente),n).then((function(o){var e;console.log(o.data),t.dadosDocumentos=o.data.documento,$("#modeloDocumento").val(null).trigger("change"),null===(e=t.editorFormulario)||void 0===e||e.setData(""),t.Anamnese.Titulo="",t.Anamnese.cdDocumento="",t.Anamnese.Documento="",toastr.success(o.data.message)})).catch((function(o){toastr.error(o.response.data.message,"Erro")})).finally((function(){t.loading=!1,t.loadingDoc=!1,t.buttonDisabled=!1,t.Anamnese.Documento=null,t.Anamnese.cdDocumento=null,t.snEdicaoDoc=!1,t.buttonSalvar=" <i class='fa fa-check'></i>  Salvar "}))},storeMsg:function(){var o=this;this.loadingDoc=!0,this.loading=!0,this.buttonEnviar=" <i class='fa fa-spinner fa-spin' aria-hidden='true'></i> Enviando... ",this.buttonDisabled=!0,axios.post("/rpclinica/json/imprimirDocumentoPaciente/".concat(this.msg.doc),this.msg).then((function(e){console.log(e.data),"200"==e.data.dados.status?(toastr.success("Mensagem enviada com sucesso!"),o.loadingTela="doc",o.msg.doc="",o.msg.titulo="",o.msg.file="",o.msg.msg="",o.msg.celular="",o.dadosEnvios=e.data.envio):toastr.error(e.data.dados.message,"Erro")})).catch((function(o){toastr.error(o.response.data.message,"Erro")})).finally((function(){o.loading=!1,o.loadingDoc=!1,o.buttonDisabled=!1,o.Anamnese.Documento=null,o.Anamnese.cdDocumento=null,o.snEdicaoDoc=!1,o.buttonEnviar=" <i class='fa fa-send-o'></i> Enviar "}))},editDocumento:function(o){var e;this.snEdicaoDoc=!0,console.log(o),$("#modeloDocumento").val(o.cd_formulario).trigger("change"),this.Anamnese.Documento=o.conteudo,this.Anamnese.cdDocumento=o.cd_documento_paciente,this.Anamnese.Titulo=o.titulo,null===(e=this.editorFormulario)||void 0===e||e.setData(o.conteudo)},cancelarEdicao:function(){$("#modeloDocumento").val(null).trigger("change"),this.Anamnese.Documento=null,this.Anamnese.cdDocumento=null,this.Anamnese.Titulo=null,this.snEdicaoDoc=!1},excluirDocumento:function(o){var e=this;Swal.fire({title:"Confirmação",html:"<h4 style='font-weight: 400;font-style: italic;'>Deseja Excluir esse Documento?</h4>",icon:"warning",showCancelButton:!0,confirmButtonColor:"#22baa0",cancelButtonColor:"#d33",cancelButtonText:"Não",confirmButtonText:"Sim"}).then((function(t){t.isConfirmed&&(e.loading=!0,e.loadingDoc=!0,axios.delete("/rpclinica/json/deleteDocumentoPac/".concat(e.pacienteSelected.cd_paciente,"/").concat(o)).then((function(o){e.dadosDocumentos=o.data.documento,toastr.success("Documento deletado com sucesso!")})).catch((function(o){return toastr.error(o.response.data.message)})).finally((function(){e.loading=!1,e.loadingDoc=!1,e.deleteDocIndice=null})))}))},teste:function(o){console.log(o),this.loadingTela="msg",this.msg.titulo=o.titulo,this.msg.msg="",this.msg.celular=this.pacienteSelected.celular,this.msg.doc=o.cd_documento_paciente}}})),$(document).ready((function(){$("#modal-resumo-paciente,#modal-historico-paciente").modal({backdrop:"static",show:!1})}));