Alpine.data("app",(function(){return{lotes:[],inputsEntrada:{cd_produto:null,cd_lote_produto:null,qtde:null,valor:null},produtosEntrada:[],inputsLoteRequired:!1,inputsLote:{nm_lote:null,cd_produto:null,validade:null},loadingModalLote:!1,init:function(){var t=this;this.lotes=lotes,$("#select-formulario-produto").on("select2:select",(function(o){t.inputsEntrada.cd_produto=o.params.data.id,t.inputsLoteRequired="S"==o.params.data.element.dataset.lote,t.changeOptionsInputLotes()})),$("#entradaLotes").on("select2:select",(function(o){t.inputsEntrada.cd_lote_produto=o.params.data.id})),$(this.$refs.modalLote).on("hidden.bs.modal",(function(){t.inputsLote={nm_lote:null,cd_produto:null,validade:null},$(t.$refs.inputProdutoModalLotes).val(null).trigger("change")})),$(this.$refs.inputProdutoModalLotes).on("select2:select",(function(o){return t.inputsLote.cd_produto=o.params.data.id})),"undefined"!=typeof entradaProdutos&&(this.produtosEntrada=entradaProdutos)},submit:function(){0!=this.produtosEntrada.length?this.$refs.formEntrada.submit():toastr.error("Adicione no mínimo 1 produto!")},changeOptionsInputLotes:function(){var t=this,o=this.lotes.filter((function(o){return o.cd_produto==t.inputsEntrada.cd_produto}));(o=o.map((function(t){return{id:t.cd_lote,text:t.nm_lote}}))).unshift({id:"",text:"SELECIONE"}),$("#entradaLotes").empty().trigger("change"),$("#entradaLotes").select2({data:o})},openModalLote:function(){return $("#modal-lote").modal("show")},addLoteProduto:function(){var t=this;this.loadingModalLote=!0,axios.post("/rpclinica/json/produto-lote",this.inputsLote).then((function(o){t.lotes.push(o.data.lote),t.changeOptionsInputLotes(),toastr.success(o.data.message),$(t.$refs.modalLote).modal("hide")})).catch((function(t){return toastr.error(t.response.data.message)})).finally((function(){return t.loadingModalLote=!1}))},addEntradaProduto:function(){!this.inputsLoteRequired||this.inputsEntrada.cd_lote_produto?(this.produtosEntrada.push(Object.assign({},this.inputsEntrada)),this.inputsEntrada={cd_produto:null,cd_lote_produto:null,qtde:null,valor:null},$("#select-formulario-produto").val(null).trigger("change"),$("#entradaLotes").empty().trigger("change"),$("#entradaLotes").select2({data:[{id:"",text:"SELECIONE"}]})):toastr.error("Escolha um lote!")},nomeDoProduto:function(t){var o;return null===(o=produtos.find((function(o){return o.cd_produto==t})))||void 0===o?void 0:o.nm_produto},nomeDoLote:function(t){var o;return t?null===(o=lotes.find((function(o){return o.cd_lote==t})))||void 0===o?void 0:o.nm_lote:'<span class="text-warning">Nenhum</span>'},deleteEntradaProduto:function(t){var o=this;Swal.fire({title:"Confirmação",text:"Tem certeza que deseja excluir esse agendamento?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Não",confirmButtonText:"Sim"}).then((function(n){if(n.isConfirmed){if(o.produtosEntrada[t].cd_entrada_produto)return void axios.post("/rpclinica/estoque-entrada-prod-delete/".concat(o.produtosEntrada[t].cd_entrada_produto)).then((function(n){toastr.success("Entrada do produto excluída com sucesso!"),o.produtosEntrada.splice(t,1)})).catch((function(t){return toastr.error("Houve um erro ao excluir a entrada do produto.")}));o.produtosEntrada.splice(t,1)}}))}}})),$(document).ready((function(){$("#modal-lote").modal({backdrop:"static",show:!1})}));