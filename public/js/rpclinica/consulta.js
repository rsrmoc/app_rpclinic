Alpine.data("app",(function(){return{saveLoadingTriagem:!1,saveLoadingAnamnese:!1,saveLoadingProblemas:!1,saveLoadingExames:!1,saveLoadingDoc:!1,tipo_doc:null,deleteDocIndice:null,formularios:[],paciente:[],documentos:[],cdDocumentoEdicao:null,historicoAgendametos:[],historicoAgendamentoSelected:null,historicoPrintAgendamento:!1,anexos:[],loadingAnexos:!1,indiceDeleteAnexo:null,editorAnamnese:null,editorExame:null,editorHipotese:null,editorConduta:null,editorDocumentos:null,editorHistoricoExames:null,editorProblemas:null,viewVip:!1,swalWithBootstrapButtons:Swal.mixin({customClass:{confirmButton:"btn btn-success swal-button",cancelButton:"btn btn-danger swal-button",input:"form-control"},buttonsStyling:!1}),assinatura_digital:{situacao:docAssinado,conteudo:null},historicoPaciente:null,init:function(){var o=this;this.formularios=formularios,this.documentos=agendamentoDocumentos,this.historicoAgendametos=historicoAgentamentos,this.paciente=paciente,"S"==this.paciente.vip?this.viewVip=!0:this.viewVip=!1,this.editorAnamnese=CKEDITOR.replace("editor-formulario-anamnese"),this.editorExame=CKEDITOR.replace("editor-formulario-exame-fisico"),this.editorHipotese=CKEDITOR.replace("editor-formulario-hipotese-diagnostica"),this.editorConduta=CKEDITOR.replace("editor-formularios-conduta"),this.editorDocumentos=CKEDITOR.replace("editor-formularios-documentos"),this.editorHistoricoExames=CKEDITOR.replace("editor-exames-tabexames"),this.editorProblemas=CKEDITOR.replace("editor-problemas"),$("#formularios-anamnese").on("select2:select",(function(t){var e=t.params.data.id,n=o.formularios.find((function(o){return e==o.cd_formulario}));o.editorAnamnese.setData(null==n?void 0:n.conteudo)})),$("#formularios-exame-fisico").on("select2:select",(function(t){var e=t.params.data.id,n=o.formularios.find((function(o){return e==o.cd_formulario}));o.editorExame.setData(null==n?void 0:n.conteudo)})),$("#formularios-hipostese-diagnostica").on("select2:select",(function(t){var e=t.params.data.id,n=o.formularios.find((function(o){return e==o.cd_formulario}));o.editorHipotese.setData(null==n?void 0:n.conteudo)})),$("#formularios-conduta").on("select2:select",(function(t){var e=t.params.data.id,n=o.formularios.find((function(o){return e==o.cd_formulario}));o.editorConduta.setData(null==n?void 0:n.conteudo)})),$("#formularios-documentos").on("select2:select",(function(t){var e=t.params.data.id,n=o.formularios.find((function(o){return e==o.cd_formulario}));o.editorDocumentos.setData(null==n?void 0:n.conteudo)})),window.addEventListener("message",(function(t){"added-anexos"===t.data&&o.getAnexos()})),this.getAnexos()},submitTriagem:function(){var o=this;this.saveLoadingTriagem=!0;var t=new FormData(document.querySelector("#tabTriagem"));axios.post("/rpclinica/json/consulta/triagem/".concat(idAgendamento),t).then((function(o){return toastr.success(o.data.message)})).catch((function(o){return toastr.error(o.response.data.message)})).finally((function(){return o.saveLoadingTriagem=!1}))},submitAnamnese:function(){var o,t,e,n,a=this;this.saveLoadingAnamnese=!0;var i=new FormData(document.querySelector("#tabAnamnese"));i.set("anamnese",null===(o=this.editorAnamnese)||void 0===o?void 0:o.getData()),i.set("exame_fisico",null===(t=this.editorExame)||void 0===t?void 0:t.getData()),i.set("hipotese_diagnostica",null===(e=this.editorHipotese)||void 0===e?void 0:e.getData()),i.set("conduta",null===(n=this.editorConduta)||void 0===n?void 0:n.getData()),axios.post("/rpclinica/json/consulta/anamnese/".concat(idAgendamento),i).then((function(o){console.log(o),toastr.success(o.data.message)})).catch((function(o){return toastr.error(o.response.data.message)})).finally((function(){return a.saveLoadingAnamnese=!1}))},submitListaProblemas:function(){var o,t=this;this.saveLoadingProblemas=!0;var e=new FormData(document.querySelector("#tabProblemas"));e.append("problemas",null===(o=this.editorProblemas)||void 0===o?void 0:o.getData()),axios.post("/rpclinica/json/consulta/problemas/".concat(idAgendamento),e).then((function(o){return toastr.success(o.data.message)})).catch((function(o){return toastr.error(o.response.data.message)})).finally((function(){return t.saveLoadingProblemas=!1}))},submitHistoricoExames:function(){var o,t=this;this.saveLoadingExames=!0;var e=new FormData(document.querySelector("#tabExames"));e.append("exames",null===(o=this.editorHistoricoExames)||void 0===o?void 0:o.getData()),axios.post("/rpclinica/json/consulta/exames/".concat(idAgendamento),e).then((function(o){return toastr.success(o.data.message)})).catch((function(o){return toastr.error(o.response.data.message)})).finally((function(){return t.saveLoadingExames=!1}))},submitDocumentos:function(){var o,t=this;this.saveLoadingDoc=!0;var e,n=new FormData(document.querySelector("#formDocumento"));null===this.cdDocumentoEdicao?(n.append("formulario",$("#formularios-documentos").val()?$("#formularios-documentos").val():"0"),n.append("conteudo",null===(o=this.editorDocumentos)||void 0===o?void 0:o.getData()),axios.post("/rpclinica/json/consulta/documento/".concat(idAgendamento),n).then((function(o){o.data.documento?(toastr.success(o.data.message),t.documentos.push(o.data.documento)):toastr.error(o.data.message),t.limbarDocs()})).catch((function(o){return toastr.error(o.response.data.message)})).finally((function(){return t.saveLoadingDoc=!1}))):axios.put("/rpclinica/json/consulta/documento/".concat(this.cdDocumentoEdicao),{conteudo:null===(e=this.editorDocumentos)||void 0===e?void 0:e.getData()}).then((function(o){toastr.success(o.data.message);var e=t.documentos.findIndex((function(o){return o.cd_documento==t.cdDocumentoEdicao}));t.documentos[e]=o.data.documento,t.limbarDocs()})).catch((function(o){return toastr.error(o.response.data.message)})).finally((function(){t.saveLoadingDoc=!1,t.cdDocumentoEdicao=null,t.editorDocumentos.setData(null),$("#tabDocumentos select#formularios-documentos").val(null).trigger("change"),$("#editor-formularios-documentos").code(null)}))},editDocumento:function(o){this.cdDocumentoEdicao=o.cd_documento,$("#tabDocumentos select#formularios-documentos").val(o.cd_formulario).trigger("change"),$("#editor-formularios-documentos").code(o.conteudo),this.editorDocumentos.setData(o.conteudo)},excluirDocumento:function(o,t){var e=this;this.swalWithBootstrapButtons.fire({title:"Confirmação",html:"<h4 style='font-weight: 400;font-style: italic;'>Deseja Excluir esse Documento?</h4>",icon:"warning",showCancelButton:!0,confirmButtonColor:"#22baa0",cancelButtonColor:"#d33",cancelButtonText:"Não",confirmButtonText:"Sim"}).then((function(n){n.isConfirmed&&(e.deleteDocIndice=t,axios.delete("/rpclinica/json/consulta/documento/delete/".concat(o)).then((function(o){toastr.success(o.data.message),e.documentos.splice(t,1)})).catch((function(o){return toastr.error(o.response.data.message)})).finally((function(){return e.deleteDocIndice=null})))}))},limbarDocs:function(){this.cdDocumentoEdicao=null,$("#editor-formularios-documentos").code(null),$("#formularios-documentos").val(null).trigger("change")},openModalHistoricoAgendamento:function(o){this.historicoAgendamentoSelected=this.historicoAgendametos.find((function(t){return t.cd_agendamento==o})),this.historicoPrintAgendamento=!0},nl2br:function(o,t,e){var n=e?"<br />":"<br>";return(o+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,t?"$1"+n:"$1"+n+"$2")},encerrarConsulta:function(o){this.swalWithBootstrapButtons.fire({title:"Confirmação",html:"<h4 style='font-weight: 400;font-style: italic;'>Deseja encerrar esse atendimento?</h4>",icon:"warning",showCancelButton:!0,confirmButtonColor:"#22baa0",cancelButtonColor:"#d33",cancelButtonText:"Não",confirmButtonText:"Sim"}).then((function(o){o.isConfirmed&&(location.href="/rpclinica/consulta-finalizar/".concat(idAgendamento))}))},imprimirAnamneseHist:function(o){console.log(o);var t="/rpclinica/consulta/anamnese/download-pdf/".concat(o);axios.all([axios.get(t,{params:{tipo:"anamnese"},responseType:"blob"})]).then(axios.spread((function(o){window.open(URL.createObjectURL(o.data),"anamnese.pdf")}))).catch((function(o){return toastr.error("Houve um erro ao imprimir.")}))},saveLoadingdocPadrao:function(o){var t=this;this.swalWithBootstrapButtons.fire({title:"Salvar Documento",icon:"warning",html:"<h4 style='font-weight: 500;font-style: italic;'>Insira o nome do Documento!</h4>",input:"text",showCancelButton:!0,confirmButtonColor:"#22BAA0",cancelButtonColor:"#d33",cancelButtonText:"Não",confirmButtonText:"Sim"}).then((function(e){var n,a,i,s,r,c,u,l,d=e.value;if("CON"==o){var m,f;new FormData(document.querySelector("#tabAnamnese")).set("conduta",null===(m=t.editorConduta)||void 0===m?void 0:m.getData());var h=null===(f=t.editorConduta)||void 0===f?void 0:f.getData()}"ATE"==o&&(new FormData(document.querySelector("#tabAnamnese")).set("anamnese",null===(n=t.editorAnamnese)||void 0===n?void 0:n.getData()),h=null===(a=t.editorAnamnese)||void 0===a?void 0:a.getData());"EXA"==o&&(new FormData(document.querySelector("#tabAnamnese")).set("exame_fisico",null===(i=t.editorExame)||void 0===i?void 0:i.getData()),h=null===(s=t.editorExame)||void 0===s?void 0:s.getData());"HIP"==o&&(new FormData(document.querySelector("#tabAnamnese")).set("hipotese_diagnostica",null===(r=t.editorHipotese)||void 0===r?void 0:r.getData()),h=null===(c=t.editorHipotese)||void 0===c?void 0:c.getData());"DOC"==o&&(new FormData(document.querySelector("#formDocumento")).set("hipotese_diagnostica",null===(u=t.editorDocumentos)||void 0===u?void 0:u.getData()),h=null===(l=t.editorDocumentos)||void 0===l?void 0:l.getData());axios.post("/rpclinica/consulta/doc_padrao",{conteudo:h,titulo:d,tipo:o}).then((function(o){toastr.success(o.data.message)})).catch((function(o){return toastr.error("Houve um erro ao imprimir o documento!")}))}))},imprimirAnamnese:function(){if($("#sn_header").is(":checked"))var o="S";else o="N";if($("#sn_footer").is(":checked"))var t="S";else t="N";if($("#sn_logo").is(":checked"))var e="S";else e="N";if($("#sn_data").is(":checked"))var n="S";else n="N";var a="/rpclinica/consulta/anamnese/download-pdf/".concat(idAgendamento);axios.all([axios.get(a,{params:{tipo:"anamnese",header:o,logo:e,footer:t,data:n,assinado:this.assinatura_digital.situacao},responseType:"blob"})]).then(axios.spread((function(o){window.open(URL.createObjectURL(o.data),"anamnese.pdf")}))).catch((function(o){return toastr.error("Houve um erro ao imprimir.")}))},imprimirDocumento:function(o){if($("#sn_doc_header").is(":checked"))var t="S";else t="N";if($("#sn_doc_footer").is(":checked"))var e="S";else e="N";if($("#sn_doc_logo").is(":checked"))var n="S";else n="N";if($("#sn_doc_data").is(":checked"))var a="S";else a="N";if($("#sn_rec_especial").is(":checked"))var i="S";else i="N";if($("#sn_assinatura").is(":checked"))var s="S";else s="N";axios.get("/rpclinica/consulta/anamnese/download-pdf/".concat(idAgendamento),{params:{tipo:"documento",cdDocumento:o,header:t,logo:n,footer:e,data:a,especial:i,assinatura:s},responseType:"blob"}).then((function(o){window.open(URL.createObjectURL(o.data),"documento.pdf")})).catch((function(o){return toastr.error("Houve um erro ao imprimir o documento!")}))},getAnexos:function(){var o=this;this.loadingAnexos=!0,axios.get("/rpclinica/json/agendamento-anexos/".concat(idAgendamento)).then((function(t){o.anexos=t.data.anexos,o.assinatura_digital.situacao=t.data.doc_assinado})).catch((function(o){return toastr.error("Erro ao buscar os anexos!")})).finally((function(){return o.loadingAnexos=!1}))},excluirAnexos:function(o,t){var e=this;this.swalWithBootstrapButtons.fire({title:"Confirmação",html:"<h4 style='font-weight: 400;font-style: italic;'>Deseja excluir esse anexo?</h4>",icon:"warning",showCancelButton:!0,confirmButtonColor:"#22baa0",cancelButtonColor:"#d33",cancelButtonText:"Não",confirmButtonText:"Sim"}).then((function(n){n.isConfirmed&&(e.indiceDeleteAnexo=t,axios.delete("/rpclinica/json/agendamento-anexos/".concat(o)).then((function(o){toastr.success(o.data.message),e.anexos.splice(t,1)})).catch((function(o){return toastr.error(o.response.data.message)})).finally((function(){return e.indiceDeleteAnexo=null})))}))},viewAnexo:function(o){"pdf"!=o.tipo&&($("#modal-viewer-anexo h4").text(o.nome),$("#modal-viewer-anexo img").attr("src",o.url_arquivo),$("#modal-viewer-anexo").modal("toggle"))},vip:function(o){var t=this;console.log(this.paciente.cd_paciente),axios.post("/rpclinica/json/paciente-vip",{status:o,paciente:this.paciente.cd_paciente}).then((function(o){t.paciente=o.data,"S"==o.data.vip?t.viewVip=!0:t.viewVip=!1})).catch((function(o){return toastr.error("Erro ao vincular Paciente como VIP!")}))},exluirDocAssinado:function(){var o=this;this.swalWithBootstrapButtons.fire({title:"Atenção!",html:"<h4 style='font-weight: 500;font-style: italic;'>Deseja excluir esse documento?</h4>",icon:"warning",showCancelButton:!0,confirmButtonColor:"#22baa0",cancelButtonColor:"#d33",cancelButtonText:"Não",confirmButtonText:" Sim"}).then((function(t){t.isConfirmed&&axios.delete("/rpclinica/json/assinatura-delete/".concat(idAgendamento,"/anamnese/1 ")).then((function(t){if(console.log(t),1==t.data.retorno){o.assinatura_digital.situacao=!1;var e="Sucesso!",n="<h4 style='font-weight: 400;font-style: italic;'>Documento excluido com sucesso!</h4>",a="success"}else e="Atenção!",n="<h4 style='font-weight: 400;font-style: italic;'>Erro ao excluir o documento!</h4>",a="error";o.swalWithBootstrapButtons.fire({title:e,html:n,icon:a,showCancelButton:!1,confirmButtonColor:"#22baa0",confirmButtonText:" Ok "})})).catch((function(o){toastr.error(o.response.data.message)}))}))},assinarDoc:function(o,t){var e=this,n="<h4 style='font-weight: 400;font-style: italic;'>Para assinar esse documento é necessario entrar com a senha do certificado!</h4> ";"D"==o&&(n="<h4 style='font-weight: 400;font-style: italic;'>Para assinar esse documento é necessario entrar com a senha do certificado!</h4> <label style='font-size: 1.3em; font-weight: 600;' > <input type='checkbox' id='AssRecEsp'  name='vehicle3' value='S'>   Receituário Especial?   </label> "),this.swalWithBootstrapButtons.fire({title:"Assinatura Digital",html:n,icon:"warning",input:"password",showCancelButton:!1,confirmButtonColor:"#22baa0",cancelButtonColor:"#d33",cancelButtonText:"Não",confirmButtonText:'  <i class="fa fa-thumbs-up"></i> Assinar Documento'}).then((function(n){if(n.isConfirmed){if(!n.value)return e.swalWithBootstrapButtons.fire("Atenção!","Senha não informada","error"),!1;var a=null,i=null;"A"==o&&(i="anamnese",t=null),"D"==o&&(i="documento",a=$("#AssRecEsp").is(":checked")?"S":"N"),axios.get("/rpclinica/consulta/anamnese/download-pdf/".concat(idAgendamento),{params:{tipo:i,cdDocumento:t,header:"N",logo:"N",footer:"N",data:"N",especial:a,assinatura:"N",assinar_digital:"S",senha:n.value}}).then((function(t){if(console.log(t),"A"==o&&(e.assinatura_digital.situacao=t.data.sn_assinado,e.assinatura_digital.conteudo=t.data.conteudo),1==t.data.retorno){if(1==t.data.sn_assinado)var n="Sucesso!",a="<h4 style='font-weight: 400;font-style: italic;'>Documento assinado com sucesso!</h4>",i="success";else n="Atenção!",a="<h4 style='font-weight: 400;font-style: italic;'>Erro ao assinar o documento!</h4>",i="error";"D"==o&&(e.documentos=t.data.documentos)}else n="Atenção!",a="<h4 style='font-weight: 400;font-style: italic;'>Erro ao salvar informação!</h4>",i="error",toastr.error(t.data.msg);e.swalWithBootstrapButtons.fire({title:n,html:a,icon:i,showCancelButton:!1,confirmButtonColor:"#22baa0",confirmButtonText:" Ok "})})).catch((function(o){toastr.error(o.response.data.message)}))}}))},historicoDoc:function(){var o=this;axios.get("/rpclinica/json/historico-documento?agendamento="+idAgendamento).then((function(t){console.log(t),o.historicoPaciente=t.data.retorno})).catch((function(o){toastr.error(o.response.data.message)})).finally((function(){return o.indiceDeleteAnexo=null})),$("#historico-documentos").modal("toggle")},importarDoc:function(o){this.cdDocumentoEdicao=null,$("#tabDocumentos select#formularios-documentos").val(o.cd_formulario).trigger("change"),$("#editor-formularios-documentos").code(o.conteudo),this.editorDocumentos.setData(o.conteudo),$("#historico-documentos").modal("hide")}}})),$(document).ready((function(){$("#cid-triagem").select2({ajax:{url:"/rpclinica/json/select2/cid",dataType:"json",processResults:function(o){return{results:o,pagination:{more:!0}}}}}),$("#modal-viewer-anexo").modal({backdrop:"static",show:!1})}));