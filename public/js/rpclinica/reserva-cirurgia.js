Alpine.data("app",(function(){return{loading:!1,retornoLista:null,paginatedData:[],currentPage:1,itemsPerPage:10,totalPages:0,index:0,loadingPesq:!1,buttonSalvar:"  <span class='glyphicon glyphicon-search' aria-hidden='true'></span> ",infoModal:{},modalTitulo:"",buttonSalvarHist:' <i  class="fa fa-check"></i> Salvar ',buttonSalvarForm:' <i  class="fa fa-check"></i> Salvar ',tempSalvarHist:' <i  class="fa fa-check"></i> Salvar ',classSituacaoReserva:{A:"btn-aberto",S:"btn-rss",C:"btn-danger",N:"btn-danger",F:"btn-success",U:"btn-info"},situacaoReserva:{A:'<i class="fa fa-chain " style="padding-left:2px;"></i> Aberta',S:'<i class="fa fa-mail-forward" style="padding-left:2px;"></i> Solicitada',C:'<i class="fa fa-ban" style="padding-left:2px;"></i> Cancelada',N:'<i class="fa fa-close " style="padding-left:2px;"></i> Negada',U:'<i class="fa fa-check-circle-o" style="padding-left:2px;"></i> Autorizada',F:'<i class="fa fa-check" style="padding-left:2px;"></i> Finalizada'},formsData:{cd_reserva:null,cd_convenio:null,valor:null,sn_negociado:null,dt_autorizacao:null,dt_solicitacao:null,guia:null,situacao:null,opme:null,obs:null,agendamento:null},init:function(){this.getPage()},paginateData:function(){var a=(this.currentPage-1)*this.itemsPerPage,o=a+this.itemsPerPage;this.paginatedData=this.retornoLista.slice(a,o)},goToPage:function(a){a>=1&&a<=this.totalPages&&(this.currentPage=a,this.paginateData())},nextPage:function(){this.currentPage<this.totalPages&&(this.currentPage++,this.paginateData())},previousPage:function(){this.currentPage>1&&(this.currentPage--,this.paginateData())},getPage:function(){var a=this;this.loadingPesq=!0,this.buttonSalvar=" <i class='fa fa-spinner fa-spin' aria-hidden='true'></i>  ";var o=new FormData(document.querySelector("#form-parametros"));axios.post("/rpclinica/json/reserva-cirurgia",o).then((function(o){a.retornoLista=o.data.query,a.totalPages=Math.ceil(a.retornoLista.length/a.itemsPerPage),a.paginateData()})).catch((function(a){toastr.error(a.response.data.message,"Erro")})).finally((function(){a.buttonSalvar="  <span class='glyphicon glyphicon-search' aria-hidden='true'></span> ",a.loadingPesq=!1}))},addHistory:function(){var a=this;this.buttonSalvarHist=" <i class='fa fa-spinner fa-spin' aria-hidden='true'></i> Salvando  ";var o=new FormData(document.querySelector("#form_RESERVA_CIRURGIA"));o.append("cd_reserva_cirurgia",this.infoModal.cd_reserva_cirurgia),axios.post("/rpclinica/json/reserva-cirurgia/addHist",o).then((function(o){a.infoModal.notes=o.data.hist})).catch((function(a){toastr.error(a.response.data.message,"Erro")})).finally((function(){a.buttonSalvarHist=a.tempSalvarHist}))},clickModal:function(a){var o=this;$("#form_FORMULARIO #idConvenio").on("select2:select",(function(){o.formsData.cd_convenio=$("#form_FORMULARIO select#idConvenio").val()})),$("#form_FORMULARIO #idOpme").on("select2:select",(function(){o.formsData.opme=$("#form_FORMULARIO select#idOpme").val()})),$("#form_FORMULARIO #idSituacao").on("select2:select",(function(){o.formsData.situacao=$("#form_FORMULARIO select#idSituacao").val()})),$("#form_FORMULARIO #idNegociado").on("select2:select",(function(){o.formsData.sn_negociado=$("#form_FORMULARIO select#idNegociado").val()})),this.infoModal=a,this.modalTitulo=a.agendamento.paciente.nm_paciente+" { "+a.cd_agendamento+" } ",axios.get("/rpclinica/json/reserva-cirurgia/getHist/".concat(a.cd_reserva_cirurgia)).then((function(a){o.infoModal.notes=a.data,console.log(o.infoModal),$(".modalDetalhes").modal("toggle"),$("#form_FORMULARIO #idConvenio").val(o.infoModal.cd_convenio).trigger("change"),$("#form_FORMULARIO #idOpme").val(o.infoModal.cd_opme).trigger("change"),$("#form_FORMULARIO #idSituacao").val(o.infoModal.situacao).trigger("change"),$("#form_FORMULARIO #idNegociado").val(o.infoModal.sn_negociado).trigger("change"),o.formsData.dt_autorizacao=o.infoModal.dt_autorizacao,o.formsData.dt_solicitacao=o.infoModal.dt_solicitacao,o.formsData.guia=o.infoModal.guia,o.formsData.valor=o.infoModal.valor?o.formatValor(o.infoModal.valor):null,o.formsData.agendamento=o.infoModal.agendamento_reserva,o.formsData.obs=o.infoModal.comentarios_form,o.formsData.cd_convenio=o.infoModal.cd_convenio,o.formsData.opme=o.infoModal.cd_opme,o.formsData.situacao=o.infoModal.situacao,o.formsData.sn_negociado=o.infoModal.sn_negociado,console.log()})).catch((function(a){toastr.error(a.response.data.message,"Erro")}))},saveFormulario:function(){var a=this;this.formsData.cd_reserva=this.infoModal.cd_reserva_cirurgia,this.buttonSalvarForm=" <i class='fa fa-spinner fa-spin' aria-hidden='true'></i> Salvando  ",axios.post("/rpclinica/json/reserva-cirurgia/addForm",this.formsData).then((function(o){toastr.success("Formulario atualizado com sucesso!"),a.getPage()})).catch((function(a){toastr.error(a.response.data.message,"Erro")})).finally((function(){a.buttonSalvarForm=a.tempSalvarHist}))},FormatData:function(a){var o=a.split(" ")[0],t=o.split("-")[2],i=o.split("-")[1],e=o.split("-")[0];return("0"+t).slice(-2)+"/"+("0"+i).slice(-2)+"/"+e},formatValor:function(a){return Intl.NumberFormat("pt-br",{style:"currency",currency:"BRL"}).format(a).replaceAll("R$Â ","")},nl2br:function(a,o){return(a+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+(o||void 0===o?"<br />":"<br>")+"$2")}}}));