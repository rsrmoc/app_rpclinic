(()=>{function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,o){if(!t)return;if("string"==typeof t)return e(t,o);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return e(t,o)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,a=new Array(e);o<e;o++)a[o]=t[o];return a}Alpine.data("app",(function(){return{checkBoleto:[],categorias,setores,eventos,formas,BoletoCartao:!1,disabledInputsPagamento:!1,inputsFilter:{tp_pesquisa:!1,dt_inicial:null,dt_final:null,cd_categoria:[],notCategoria:!1,cd_setor:[],notSetor:!1,cd_fornecedor:[],notFornecedor:!1,cd_conta:[],notConta:!1,cd_forma:[],notForma:!1,cd_turma:[],notTurma:!1,ds_boleto:null,nr_documento:null,credito:!0,debito:!0,realizado:!0,n_realizado:!0,vencido:!0,a_vencer:!0,transferencia:!0,lancamentos:!0,ano:(new Date).getFullYear(),mes:(new Date).getMonth()+1,colunaOrdenada:null,direcaoOrdenacao:null,page:null,itemsPerPage:50},boletoSelecionado:null,boletos:[],boletosSaldoAnterior:0,totalReceita:0,totalDespesa:0,classStatus:{Recebido:"label-recebido","A receber":"label-warning",Pago:"label-info",Vencido:"label-danger","A vencer":"label-aguardando"},loadingExclusao:!1,loadingEstorno:!1,loadingUpdate:!1,inputsValorPagoShow:!1,opcaoValorRestante:"confirmar",inputsLancamentoValorRestante:{data_vencimento:null,parcela_descricao:!1,valor_restante:null},labelResumo:{vl_receita:0,vl_despesa:0,loadingSaldo:!1},buttonPesquisar:'<span class="glyphicon glyphicon-filter" aria-hidden="true"></span> Pesquisar',labelSaldo:"R$ 0,00",templateButtonSalvar:'<i class="fa fa-check"></i> Salvar',templateButtonSalvando:" <i class='fa fa-spinner fa-spin' aria-hidden='true'></i> Salvando ",buttonSalvar:'<i class="fa fa-check"></i> Salvar',paginatedData:[],currentPage:1,itemsPerPage:20,totalPages:0,loadingPesq:!1,retornoLista:null,init:function(){var t=this;this.getPage(),$("#filterCategoria").on("select2:select",(function(){t.inputsFilter.cd_categoria=$("#filterCategoria").val()})),$("#filterCategoria").on("select2:unselect",(function(){t.inputsFilter.cd_categoria=$("#filterCategoria").val()})),$("#filterSetor").on("select2:select",(function(){t.inputsFilter.cd_setor=$("#filterSetor").val()})),$("#filterSetor").on("select2:unselect",(function(){t.inputsFilter.cd_setor=$("#filterSetor").val()})),$("#filterFornecedor").on("select2:select",(function(){t.inputsFilter.cd_fornecedor=$("#filterFornecedor").val()})),$("#filterFornecedor").on("select2:unselect",(function(){t.inputsFilter.cd_fornecedor=$("#filterFornecedor").val()})),$("#filterForma").on("select2:select",(function(){t.inputsFilter.cd_forma=$("#filterForma").val()})),$("#filterForma").on("select2:unselect",(function(){t.inputsFilter.cd_forma=$("#filterForma").val()})),$("#filterConta").on("select2:select",(function(){t.inputsFilter.cd_conta=$("#filterConta").val()})),$("#filterConta").on("select2:unselect",(function(){t.inputsFilter.cd_conta=$("#filterConta").val()})),$("#filterTurma").on("select2:select",(function(){t.inputsFilter.cd_turma=$("#filterTurma").val()})),$("#filterTurma").on("select2:unselect",(function(){t.inputsFilter.cd_turma=$("#filterTurma").val()})),$("#opcoesDispiniveisValorPago").on("select2:select",(function(e){return t.opcaoValorRestante=e.params.data.id}))},registroPagina:function(t){this.inputsFilter.itemsPerPage=t,this.getPage()},goToPage:function(t){t>=1&&t<=this.totalPages&&(this.inputsFilter.page=t,this.currentPage=t,this.inputsFilter.page=this.currentPage,this.getPage())},nextPage:function(){this.currentPage<this.totalPages&&(this.currentPage++,this.inputsFilter.page=this.currentPage,this.getPage())},previousPage:function(){this.currentPage>1&&(this.currentPage--,this.getPage())},getPage:function(){var t=this;this.loadingPesq=!0,this.buttonPesquisar=" <i class='fa fa-spinner fa-spin' aria-hidden='true'></i> Pesquisando ",axios.get("/rpclinica/json/financeiro-json-modal",{params:this.inputsFilter}).then((function(e){console.log(e.data),t.labelSaldo=e.data.saldo_anterior?t.formatValor(e.data.saldo_anterior):"0,00",t.retornoLista=e.data.boletos.data,t.totalPages=e.data.boletos.last_page,t.paginatedData=t.retornoLista,t.labelResumo.vl_receita=e.data.vlReceita,t.labelResumo.vl_despesa=e.data.vlDespesa})).catch((function(t){toastr.error(t.response.data.message,"Erro")})).finally((function(){t.loadingPesq=!1,t.buttonPesquisar='<span class="glyphicon glyphicon-filter" aria-hidden="true"></span> Pesquisar',t.inputsFilter.tp_pesquisa=!1}))},submitFilters:function(){this.inputsFilter.tp_pesquisa=!0,this.getPage()},ordenarPor:function(t){this.inputsFilter.colunaOrdenada=t,$(".glyphicon-sort-by-attributes-alt, .glyphicon-sort-by-attributes").removeClass("glyphicon-sort-by-attributes-alt glyphicon-sort-by-attributes"),$("."+t).addClass("ASC"===this.inputsFilter.direcaoOrdenacao?"glyphicon glyphicon-sort-by-attributes-alt":"glyphicon glyphicon-sort-by-attributes"),$("."+t).css({display:"inline",width:"5px"}),this.inputsFilter.direcaoOrdenacao="ASC"===this.inputsFilter.direcaoOrdenacao?"DESC":"ASC"},checkAll:function(){$(".checkOne").prop("checked",$(".checkAll").prop("checked"))},resetDatas:function(){this.inputsFilter.dt_final=null,this.inputsFilter.dt_inicial=null},Quitar:function(){var t=this;Swal.fire({title:"Confirmação",text:"Tem certeza que deseja quitar as parcela selecionadas?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#22BAA0",cancelButtonColor:"#d33",cancelButtonText:"Não",confirmButtonText:"Sim"}).then((function(e){if(e.isConfirmed){var o=new FormData(document.querySelector("#form-boletos"));axios.post("/rpclinica/json/financeiro-quitar-boleto/RELACAO",o).then((function(e){console.log(e.data),t.getPage(),document.getElementById("form-boletos").reset(),toastr.success("Parcelas quitadas com sucesso!")})).catch((function(t){return parseErrorsAPI(t)})).finally((function(){return t.loadingEstorno=!1}))}}))},QuitarRapido:function(t){var e=this;Swal.fire({title:"Confirmação",text:"Tem certeza que deseja quitar a parcela selecionada?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#22BAA0",cancelButtonColor:"#d33",cancelButtonText:"Não",confirmButtonText:"Sim"}).then((function(o){o.isConfirmed&&axios.post("/rpclinica/json/financeiro-quitar-boleto/RAPIDO",t).then((function(t){e.getPage(),$("#modal-parcela").modal("hide"),toastr.success("Parcelas quitadas com sucesso!")})).catch((function(t){return parseErrorsAPI(t)})).finally((function(){return e.loadingEstorno=!1}))}))},Excluir:function(){var t=this;Swal.fire({title:"Confirmação",text:"Tem certeza que deseja excluir as parcelas selecionadas?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#22BAA0",cancelButtonColor:"#d33",cancelButtonText:"Não",confirmButtonText:"Sim"}).then((function(e){if(e.isConfirmed){var o=new FormData(document.querySelector("#form-boletos"));axios.post("/rpclinica/json/financeiro-quitar-boleto",o).then((function(e){console.log(e.data),t.getPage(),document.getElementById("form-boletos").reset(),toastr.success("Parcelas exluidas com sucesso!")})).catch((function(t){return parseErrorsAPI(t)})).finally((function(){return t.loadingEstorno=!1}))}}))},selectMonth:function(t){this.inputsFilter.mes=t,this.resetDatas(),this.getPage()},prevMonth:function(){this.inputsFilter.mes=this.inputsFilter.mes>0?this.inputsFilter.mes-1:this.inputsFilter.mes,this.resetDatas(),this.getPage()},nextMonth:function(){this.inputsFilter.mes=this.inputsFilter.mes<12?this.inputsFilter.mes+1:this.inputsFilter.mes,this.resetDatas(),this.getPage()},prevYear:function(){this.inputsFilter.ano=this.inputsFilter.ano-1,this.resetDatas(),this.getPage()},nextYear:function(){this.inputsFilter.ano=this.inputsFilter.ano+1,this.resetDatas(),this.getPage()},selecionarBoleto:function(e){var o=this;this.clear(),this.boletoSelecionado=Object.assign({},e),this.disabledInputsPagamento=!1,console.log(this.boletoSelecionado),"CA"==e.conta.tp_conta?(this.disabledInputsPagamento=!0,this.BoletoCartao=!0,this.opcaoValorRestante="confirmar"):(this.disabledInputsPagamento=!1,this.BoletoCartao=!1),$("#modalParcelaCategoria").empty(),$("#modalParcelaCategoria").select2({data:[{id:"",text:"Selecione"}].concat(t(this.categorias.filter((function(t){return t.cd_empresa==o.boletoSelecionado.cd_empresa})).map((function(t){return{id:t.cd_categoria,text:t.nm_categoria,disabled:t.lanc,element:HTMLOptionElement}}))))}),$("#lancamentosTurmas").on("select2:select",(function(e){var o=e.params.data.id;$("#lancamentosEventos").empty(),$("#lancamentosEventos").select2({data:[{id:"",text:"Selecione"}].concat(t(eventos.filter((function(t){return t.cd_turma==o})).map((function(t){return{id:t.cd_evento,text:t.nm_evento}}))))})})),$("#modalParcelaConta").on("select2:select",(function(e){var a=e.params.data.element,n=e.params.data.id;o.disabledInputsPagamento=n&&"CA"==a.dataset.tp,o.tp_conta=a.dataset.tp,"CA"==a.dataset.tp?($("#modalParcelaForma").empty(),$("#modalParcelaForma").select2({data:[{id:"",text:"Selecione"}].concat(t(o.formas.filter((function(t){return"CA"==t.tipo})).map((function(t){return{id:t.cd_forma_pag,text:t.nm_forma_pag}}))))}),console.log(formas)):($("#modalParcelaForma").empty(),$("#modalParcelaForma").select2({data:[{id:"",text:"Selecione"}].concat(t(o.formas.filter((function(t){return"CA"!=t.tipo})).map((function(t){return{id:t.cd_forma_pag,text:t.nm_forma_pag}}))))}))})),$("#lancamentosEventos").empty(),$("#lancamentosEventos").select2({data:[{id:"",text:"Selecione"}].concat(t(this.eventos.filter((function(t){return t.cd_turma==o.boletoSelecionado.cd_turma})).map((function(t){return{id:t.cd_evento,text:t.nm_evento}}))))}),$("#modalParcelaCategoria").val(this.boletoSelecionado.cd_categoria).trigger("change"),$("#modalParcelaConta").val(this.boletoSelecionado.cd_conta).trigger("change"),$("#modalParcelaForma").val(this.boletoSelecionado.cd_forma).trigger("change"),$("#modalParcelaFornecedor").val(this.boletoSelecionado.cd_fornecedor).trigger("change"),$("#modalParcelaSetor").val(this.boletoSelecionado.cd_setor).trigger("change"),$("#modalParcelaMarca").val(this.boletoSelecionado.cd_marca).trigger("change"),$("#lancamentosTurmas").val(this.boletoSelecionado.cd_turma).trigger("change"),$("#lancamentosEventos").val(this.boletoSelecionado.cd_evento).trigger("change"),$("#modalParcelaCompra").val(this.boletoSelecionado.data_compra),"despesa"==this.boletoSelecionado.tipo&&document.querySelector("#modalParcelaDespesa").click(),"receita"==this.boletoSelecionado.tipo&&document.querySelector("#modalParcelaReceita").click(),$("#modal-parcela").modal("toggle")},calcSaldoTotalBoletos:function(){return this.retornoLista.reduce((function(t,e){return"receita"==e.tipo?t+e.vl_boleto:t-e.vl_boleto}),0)},calcSaldoTotalBoletosReceita:function(){return this.retornoLista.reduce((function(t,e){return"receita"==e.tipo?t+e.vl_boleto:t-0}),0)},calcSaldoTotalBoletosDespesa:function(){return this.retornoLista.reduce((function(t,e){return"despesa"==e.tipo?t+e.vl_boleto:t-0}),0)},formatValor:function(t){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t)},excluirParcela:function(){var t=this;if("CA"==this.boletoSelecionado.conta.tp_conta&&"QUITADO"==this.boletoSelecionado.situacao)return toastr.error("Documento  do tipo cartão e quitado. <br>Não será possivel e exclusão!");Swal.fire({title:"Confirmação",text:"Tem certeza que deseja excluir essa parcela?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#22BAA0",cancelButtonColor:"#d33",cancelButtonText:"Não",confirmButtonText:"Sim"}).then((function(e){e.isConfirmed&&(t.loadingExclusao=!0,axios.delete("/rpclinica/json/financeiro-excluir-parcela/".concat(t.boletoSelecionado.cd_documento_boleto)).then((function(e){var o=t.boletos.findIndex((function(e){return e.cd_documento_boleto==t.boletoSelecionado.cd_documento_boleto}));t.boletos.splice(o,1),t.submitFilters(),toastr.success(e.data.message),$("#modal-parcela").modal("toggle")})).catch((function(t){return parseErrorsAPI(t)})).finally((function(){return t.loadingExclusao=!1})))}))},estornarParcela:function(){var t=this;return"CA"==this.boletoSelecionado.conta.tp_conta&&"QUITADO"==this.boletoSelecionado.situacao?toastr.error("Documento  do tipo cartão e quitado. <br>Não será possivel e estornar!"):"TR"==this.boletoSelecionado.tp_mov?toastr.error("Não permitido estornar documento  do tipo Transferencia."):void Swal.fire({title:"Confirmação",text:"Tem certeza que deseja excluir essa parcela?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#22BAA0",cancelButtonColor:"#d33",cancelButtonText:"Não",confirmButtonText:"Sim"}).then((function(e){e.isConfirmed&&(t.loadingEstorno=!0,axios.put("/rpclinica/json/financeiro-estornar-parcela/".concat(t.boletoSelecionado.cd_documento_boleto)).then((function(e){var o=t.boletos.findIndex((function(e){return e.cd_documento_boleto==t.boletoSelecionado.cd_documento_boleto}));t.boletos.splice(o,1),t.submitFilters(),toastr.success(e.data.message),$("#modal-parcela").modal("toggle")})).catch((function(t){return parseErrorsAPI(t)})).finally((function(){return t.loadingEstorno=!1})))}))},clear:function(){this.inputsValorPagoShow=!1,this.opcaoValorRestante="confirmar",$("#opcoesDispiniveisValorPago").val("confirmar").trigger("change"),this.inputsLancamentoValorRestante={data_vencimento:null,parcela_descricao:!1,valor_restante:null},this.disabledInputsPagamento=!1},updateParcela:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],o=0,a=parseFloat($("#modalParcelaValor").val().replace(".","").replace(",","."));if(0==this.BoletoCartao&&(o=parseFloat($("#modalParcelaValorPago").val().replace(".","").replace(",",".")),e&&o<a))return this.inputsLancamentoValorRestante.valor_restante=a-o,void(this.inputsValorPagoShow=!0);var n=new FormData(document.querySelector("#modalParcelaForm"));n.set("id",this.boletoSelecionado.cd_documento_boleto),n.set("vl_boleto",a),n.set("vl_pagrec",o),this.inputsValorPagoShow&&"gerar"==this.opcaoValorRestante&&(n.set("valor_restante[data_vencimento]",this.inputsLancamentoValorRestante.data_vencimento),n.set("valor_restante[parcela_descricao]",this.inputsLancamentoValorRestante.parcela_descricao),n.set("valor_restante[valor_restante]",this.inputsLancamentoValorRestante.valor_restante)),this.buttonSalvar=this.templateButtonSalvando,axios.post("/rpclinica/json/financeiro-update-lancamento",n).then((function(e){var o=t.boletos.findIndex((function(e){return e.cd_documento_boleto==t.boletoSelecionado.cd_documento_boleto}));t.boletos[o]=e.data.boleto,t.inputsValorPagoShow&&t.clear(),toastr.success(e.data.message),t.submitFilters(),$("#modal-parcela").modal("toggle")})).catch((function(t){return parseErrorsAPI(t)})).finally((function(){t.buttonSalvar=t.buttonSalvar=t.templateButtonSalvar,t.loadingUpdate=!1}))}}})),$(document).ready((function(){$("#modal-parcela").modal({backdrop:"static",show:!1})}))})();